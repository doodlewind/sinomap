var Sinomap=function(){"use strict";function t(t,e){var n=w*t*S,i=Math.max(Math.min(x,e),-x)*S;return i=w*Math.log(Math.tan(Math.PI/4+i/2)),[n,i]}function e(e){var n=[];return e.features.forEach(function(e){"Polygon"===e.geometry.type?e.geometry.coordinates.forEach(function(e){n=n.concat(e.map(function(e){return t(e[0],e[1])}))}):e.geometry.coordinates.forEach(function(e){e.forEach(function(e){n=n.concat(e.map(function(e){return t(e[0],e[1])}))})})}),n}function n(t){var e=t.reduce(function(t,e){return t[0]<e[0]?t:e})[0],n=t.reduce(function(t,e){return t[0]>e[0]?t:e})[0],i=t.reduce(function(t,e){return t[1]<e[1]?t:e})[1];return{w:n-e,h:t.reduce(function(t,e){return t[1]>e[1]?t:e})[1]-i,minX:e,minY:i}}function i(t,e){var n=b(t,2),i=n[0],r=n[1],o=b(e,2),a=o[0],u=o[1],c=i/r/(a/u)>1,s=c?a/i:u/r;return[c?0:(a-i*s)/2,c?(u-r*s)/2:0,s]}function r(e,n,i){return i.map(function(i){var r=t(i[0],i[1]),o=b(r,2),a=o[0],u=o[1];return[a-e,u-n]})}function o(t,r,o){var a=e(t),u=n(a),c=i([u.w,u.h],[r,o]),s=b(c,3),h=s[0],f=s[1],l=s[2];return{offsetX:h,offsetY:f,minX:u.minX,minY:u.minY,areaScale:l}}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.minX,i=e.minY,o=e.offsetX,a=e.offsetY,u=e.areaScale,c=e.height;return r(n,i,t).map(function(t){return[t[0]*u+o,c-t[1]*u-a]})}function u(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1}function c(t,e,n){var i=document.createElement("canvas");return i.width=t*n,i.height=e*n,i.style.width=t+"px",i.style.height=e+"px",i.getContext("2d").scale(n,n),i}function s(t){var e=this;t.addEventListener("mousemove",function(t){var n=e.mapCanvas.getBoundingClientRect();e.mouseX=(t.clientX-n.left)*e.mapCanvas.width/n.width,e.mouseY=(t.clientY-n.top)*e.mapCanvas.height/n.height,e.update()})}function h(t,e,n){t.fillStyle=n,l(t,e)}function f(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.offsetX,r=n.offsetY,o=n.minX,u=n.minY,c=n.areaScale,s=a(t,{minX:o,minY:u,offsetX:i,offsetY:r,areaScale:c,height:this.height});this.ctx.fillStyle=this.style.color,this.ctx.strokeStyle=this.style.borderColor,l(this.ctx,s),this.ctx.stroke(),this.ctx.isPointInPath(this.mouseX,this.mouseY)&&h(this.ctx,s,this.style.hoverColor),this.layer.afterSubArea&&this.layer.afterSubArea(this,s,e)}function l(t,e){e.forEach(function(n,i){var r=[e[i][0],e[i][1]],o=r[0],a=r[1];0===i&&t.beginPath(),t.lineTo(o,a)}),t.closePath(),t.fill()}function d(t,e,n){var i="string"==typeof this.el?document.querySelector(this.el):this.el;if(!i)throw new Error("[Sinomap] Target element not found.");this.mouseX=0,this.mouseY=0,this.canvasScale=u(),this.mapCanvas=c(this.width,this.height,this.canvasScale),this.ctx=this.mapCanvas.getContext("2d"),this.utils={drawPath:l},i.appendChild(this.mapCanvas),s.bind(this)(this.mapCanvas)}function m(){var t=this,e=o(this.area,this.width,this.height);this.area.features.forEach(function(n){"Polygon"===n.geometry.type?n.geometry.coordinates.forEach(function(i){return f.bind(t)(i,n.properties,e)}):n.geometry.coordinates.forEach(function(i){return i.forEach(function(i){return f.bind(t)(i,n.properties,e)})})})}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){}function p(t){}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var b=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&u.return&&u.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),w=6378137,x=85.0511287798,S=Math.PI/180,C={el:null,width:600,height:400,style:{color:"#ddd",hoverColor:"rgba(255, 255, 255, 0.5)",borderColor:"white"},area:null},E=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),P=function(){function t(){v(this,t),this.color="red",this.data=[{name:"福建",value:123}],this.onEnter=y.bind(this),this.onLeave=p.bind(this)}return E(t,[{key:"beforeArea",value:function(){}},{key:"afterSubArea",value:function(t,e,n){n.name===this.data[0].name&&(t.ctx.fillStyle=this.color,t.utils.drawPath(t.ctx,e))}},{key:"afterArea",value:function(){}}]),t}(),X=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();return function(){function t(e){g(this,t),this.init(e),this.update()}return X(t,[{key:"init",value:function(t){var e=this;t.style=Object.assign({},C.style,t.style),t=Object.assign({},C,t),Object.keys(t).forEach(function(n){e[n]=t[n]}),this.layer=new P,d.bind(this)()}},{key:"update",value:function(){m.bind(this)()}}]),t}()}();
