var Sinomap=function(){"use strict";function t(t,n){var e=v*t*g,r=Math.max(Math.min(m,n),-m)*g;return r=v*Math.log(Math.tan(Math.PI/4+r/2)),[e,r]}function n(n){var e=[];return n.features.forEach(function(n){"Polygon"===n.geometry.type?n.geometry.coordinates.forEach(function(n){e=e.concat(n.map(function(n){return t(n[0],n[1])}))}):n.geometry.coordinates.forEach(function(n){n.forEach(function(n){e=e.concat(n.map(function(n){return t(n[0],n[1])}))})})}),e}function e(t){var n=t.reduce(function(t,n){return t[0]<n[0]?t:n})[0],e=t.reduce(function(t,n){return t[0]>n[0]?t:n})[0],r=t.reduce(function(t,n){return t[1]<n[1]?t:n})[1];return{w:e-n,h:t.reduce(function(t,n){return t[1]>n[1]?t:n})[1]-r,xMin:n,yMin:r}}function r(t,n){var e=y(t,2),r=e[0],i=e[1],o=y(n,2),a=o[0],u=o[1],c=r/i/(a/u)>1,f=c?a/r:u/i;return[c?0:(a-r*f)/2,c?(u-i*f)/2:0,f]}function i(t,i,o){var a=n(t),u=e(a),c=r([u.w,u.h],[i,o]),f=y(c,3),h=f[0],s=f[1],l=f[2];return{offsetX:h,offsetY:s,xMin:u.xMin,yMin:u.yMin,scale:l}}function o(n,e,r){return r.map(function(r){var i=t(r[0],r[1]),o=y(i,2),a=o[0],u=o[1];return[a-n,u-e]})}function a(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1}function u(t,n){var e=document.createElement("canvas"),r=a();return e.width=t*r,e.height=n*r,e.style.width=t+"px",e.style.height=n+"px",e.getContext("2d").scale(r,r),e}function c(t){var n=this;t.addEventListener("mousemove",function(t){return n.update()})}function f(){var t=function(){return parseInt(255*Math.random()).toString(16)};return"#"+t()+t()+t()}function h(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=(e.width,e.height),i=e.xOff,a=e.yOff,u=e.xMin,c=e.yMin,h=e.scale,s=e.style,l=void 0===s?{}:s,d=o(u,c,n);t.fillStyle=f(),t.strokeStyle=l.borderColor;for(var y=0;y<d.length;y++){var v=[d[y][0],d[y][1]],m=v[0],g=v[1];0===y&&t.beginPath(),t.lineTo(m*h+i,r-g*h-a)}t.closePath(),t.fill(),t.stroke()}function s(t,n,e){var r="string"==typeof this.el?document.querySelector(this.el):this.el;if(!r)throw new Error("[Sinomap] Target element not found.");this.mapCanvas=u(this.width,this.height),this.ctx=this.mapCanvas.getContext("2d"),r.appendChild(this.mapCanvas),c.bind(this)(this.mapCanvas)}function l(){var t=this,n=i(this.area,this.width,this.height),e={width:this.width,height:this.height,style:this.style,xOff:n.offsetX,yOff:n.offsetY,xMin:n.xMin,yMin:n.yMin,scale:n.scale};return this.area.features.forEach(function(n){"Polygon"===n.geometry.type?n.geometry.coordinates.forEach(function(n){h(t.ctx,n,e)}):n.geometry.coordinates.forEach(function(n){n.forEach(function(n){h(t.ctx,n,e)})})}),this}function d(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var y=function(){function t(t,n){var e=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=6378137,m=85.0511287798,g=Math.PI/180,p=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}();return function(){function t(n){var e=this;return d(this,t),Object.keys(n).forEach(function(t){e[t]=n[t]}),this.init(),this.update(),this}return p(t,[{key:"init",value:function(){s.bind(this)()}},{key:"update",value:function(){l.bind(this)()}}]),t}()}();
