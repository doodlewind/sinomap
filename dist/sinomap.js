var Sinomap=function(){"use strict";function t(t,n){var e=g*t*w,i=Math.max(Math.min(y,n),-y)*w;return i=g*Math.log(Math.tan(Math.PI/4+i/2)),[e,i]}function n(n){var e=[];return n.features.forEach(function(n){"Polygon"===n.geometry.type?n.geometry.coordinates.forEach(function(n){e=e.concat(n.map(function(n){return t(n[0],n[1])}))}):n.geometry.coordinates.forEach(function(n){n.forEach(function(n){e=e.concat(n.map(function(n){return t(n[0],n[1])}))})})}),e}function e(t){var n=t.reduce(function(t,n){return t[0]<n[0]?t:n})[0],e=t.reduce(function(t,n){return t[0]>n[0]?t:n})[0],i=t.reduce(function(t,n){return t[1]<n[1]?t:n})[1];return{w:e-n,h:t.reduce(function(t,n){return t[1]>n[1]?t:n})[1]-i,minX:n,minY:i}}function i(t,n){var e=p(t,2),i=e[0],r=e[1],o=p(n,2),a=o[0],h=o[1],c=i/r/(a/h)>1,s=c?a/i:h/r;return[c?0:(a-i*s)/2,c?(h-r*s)/2:0,s]}function r(n,e,i){return i.map(function(i){var r=t(i[0],i[1]),o=p(r,2),a=o[0],h=o[1];return[a-n,h-e]})}function o(t,r,o){var a=n(t),h=e(a),c=i([h.w,h.h],[r,o]),s=p(c,3),u=s[0],f=s[1],l=s[2];return{offsetX:u,offsetY:f,minX:h.minX,minY:h.minY,areaScale:l}}function a(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=n.minX,i=n.minY,o=n.offsetX,a=n.offsetY,h=n.areaScale,c=n.height;return r(e,i,t).map(function(t){return[t[0]*h+o,c-t[1]*h-a]})}function h(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1}function c(t,n,e){var i=document.createElement("canvas");return i.width=t*e,i.height=n*e,i.style.width=t+"px",i.style.height=n+"px",i.getContext("2d").scale(e,e),i}function s(t){var n=this;t.addEventListener("mousemove",function(t){var e=n.mapCanvas.getBoundingClientRect();n.mouseX=(t.clientX-e.left)*n.mapCanvas.width/e.width,n.mouseY=(t.clientY-e.top)*n.mapCanvas.height/e.height,n.updateMap()})}function u(t,n,e){t.fillStyle=e,l(t,n)}function f(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=e.offsetX,r=e.offsetY,o=e.minX,h=e.minY,c=e.areaScale,s=a(t,{minX:o,minY:h,offsetX:i,offsetY:r,areaScale:c,height:this.height});this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.borderColor,l(this.ctx,s),this.ctx.stroke(),this.ctx.isPointInPath(this.mouseX,this.mouseY)&&u(this.ctx,s,this.hoverColor),this.layer.afterDrawArea&&this.layer.afterDrawArea(this,s,n)}function l(t,n){n.forEach(function(e,i){var r=[n[i][0],n[i][1]],o=r[0],a=r[1];0===i&&t.beginPath(),t.lineTo(o,a)}),t.closePath(),t.fill()}function d(t,n,e){var i="string"==typeof this.el?document.querySelector(this.el):this.el;if(!i)throw new Error("[Sinomap] Target element not found.");this.mouseX=0,this.mouseY=0,this.hoverArea=null,this.canvasScale=h(),this.mapCanvas=c(this.width,this.height,this.canvasScale),this.ctx=this.mapCanvas.getContext("2d"),this.utils={drawPath:l},i.appendChild(this.mapCanvas),s.bind(this)(this.mapCanvas)}function m(){var t=this,n=o(this.geoJSON,this.width,this.height);this.geoJSON.features.forEach(function(e){"Polygon"===e.geometry.type?e.geometry.coordinates.forEach(function(i){return f.bind(t)(i,e.properties,n)}):e.geometry.coordinates.forEach(function(i){return i.forEach(function(i){return f.bind(t)(i,e.properties,n)})})})}var v=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},p=function(){function t(t,n){var e=[],i=!0,r=!1,o=void 0;try{for(var a,h=t[Symbol.iterator]();!(i=(a=h.next()).done)&&(e.push(a.value),!n||e.length!==n);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&h.return&&h.return()}finally{if(r)throw o}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=6378137,y=85.0511287798,w=Math.PI/180,S={el:null,width:600,height:400,layer:{},color:"#ddd",hoverColor:"rgba(255, 255, 255, 0.5)",borderColor:"white",geoJSON:null};return function t(n){var e=this;v(this,t),this.updateMap=m.bind(this),n=Object.assign({},S,n),Object.keys(n).forEach(function(t){e[t]=n[t]}),d.bind(this)(),this.updateMap()}}();
