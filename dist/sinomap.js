var Sinomap=function(){"use strict";function t(t,e){var n=C*t*X,a=Math.max(Math.min(P,e),-P)*X;return a=C*Math.log(Math.tan(Math.PI/4+a/2)),[n,a]}function e(e){var n=[];return e.features.forEach(function(e){"Polygon"===e.geometry.type?e.geometry.coordinates.forEach(function(e){n=n.concat(e.map(function(e){return t(e[0],e[1])}))}):e.geometry.coordinates.forEach(function(e){e.forEach(function(e){n=n.concat(e.map(function(e){return t(e[0],e[1])}))})})}),n}function n(t){var e=t.reduce(function(t,e){return t[0]<e[0]?t:e})[0],n=t.reduce(function(t,e){return t[0]>e[0]?t:e})[0],a=t.reduce(function(t,e){return t[1]<e[1]?t:e})[1];return{w:n-e,h:t.reduce(function(t,e){return t[1]>e[1]?t:e})[1]-a,minX:e,minY:a}}function a(t,e){var n=E(t,2),a=n[0],i=n[1],r=E(e,2),o=r[0],u=r[1],l=a/i/(o/u)>1,c=l?o/a:u/i;return[l?0:(o-a*c)/2,l?(u-i*c)/2:0,c]}function i(e,n,a){return a.map(function(a){var i=t(a[0],a[1]),r=E(i,2),o=r[0],u=r[1];return[o-e,u-n]})}function r(t,i,r){var o=e(t),u=n(o),l=a([u.w,u.h],[i,r]),c=E(l,3),h=c[0],s=c[1],f=c[2];return{offsetX:h,offsetY:s,minX:u.minX,minY:u.minY,areaScale:f}}function o(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.minX,a=e.minY,r=e.offsetX,o=e.offsetY,u=e.areaScale,l=e.height;return i(n,a,t).map(function(t){return[t[0]*u+r,l-t[1]*u-o]})}function u(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1}function l(t,e,n){var a=document.createElement("canvas");return a.width=t*n,a.height=e*n,a.style.width=t+"px",a.style.height=e+"px",a.getContext("2d").scale(n,n),a}function c(t){var e=this;t.addEventListener("mousemove",function(t){var n=e.mapCanvas.getBoundingClientRect();e.mouseX=(t.clientX-n.left)*e.mapCanvas.width/n.width,e.mouseY=(t.clientY-n.top)*e.mapCanvas.height/n.height,e.update()})}function h(t,e,n){t.fillStyle=n,f(t,e)}function s(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.offsetX,i=n.offsetY,r=n.minX,u=n.minY,l=n.areaScale,c=o(t,{minX:r,minY:u,offsetX:a,offsetY:i,areaScale:l,height:this.height});this.ctx.fillStyle=this.style.color,this.ctx.strokeStyle=this.style.borderColor,f(this.ctx,c),this.ctx.stroke(),this.ctx.isPointInPath(this.mouseX,this.mouseY)&&h(this.ctx,c,this.style.hoverColor),this.layer.afterSubArea&&this.layer.afterSubArea(this,c,e)}function f(t,e){e.forEach(function(n,a){var i=[e[a][0],e[a][1]],r=i[0],o=i[1];0===a&&t.beginPath(),t.lineTo(r,o)}),t.closePath(),t.fill()}function v(t,e,n){var a="string"==typeof this.el?document.querySelector(this.el):this.el;if(!a)throw new Error("[Sinomap] Target element not found.");this.mouseX=0,this.mouseY=0,this.canvasScale=u(),this.mapCanvas=l(this.width,this.height,this.canvasScale),this.ctx=this.mapCanvas.getContext("2d"),this.utils={drawPath:f},a.appendChild(this.mapCanvas),c.bind(this)(this.mapCanvas)}function m(){var t=this,e=r(this.area,this.width,this.height);this.area.features.forEach(function(n){"Polygon"===n.geometry.type?n.geometry.coordinates.forEach(function(a){return s.bind(t)(a,n.properties,e)}):n.geometry.coordinates.forEach(function(a){return a.forEach(function(a){return s.bind(t)(a,n.properties,e)})})})}function d(t,e){var n=null;return e.forEach(function(e){e.name===t&&(n=e.value)}),n}function y(t,e){for(var n=t.length,a=t.map(function(t,e){return 1/n*(n-e)}),i=0;i<t.length;i++)if(e<=t[i])return"rgba(255, 255, 255, "+(a[i]-.1)+")"}function p(t,e){var n=t.map(function(t){return t.value});n.sort(function(t,e){return t>e?1:-1});var a=Math.floor(n.length/e);return a<=1?n:Array.from(new Array(e-1)).map(function(t,e){return n[a*(e+1)]})}function g(t,e,n){var a=parseInt(d(n.name,this.data));a&&(t.ctx.fillStyle=this.color,t.utils.drawPath(t.ctx,e),t.ctx.fillStyle=y(this.thresholds,a),t.utils.drawPath(t.ctx,e))}function b(t,e){}function w(t){}var S=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},x=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),E=function(){function t(t,e){var n=[],a=!0,i=!1,r=void 0;try{for(var o,u=t[Symbol.iterator]();!(a=(o=u.next()).done)&&(n.push(o.value),!e||n.length!==e);a=!0);}catch(t){i=!0,r=t}finally{try{!a&&u.return&&u.return()}finally{if(i)throw r}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),C=6378137,P=85.0511287798,X=Math.PI/180,Y={el:null,width:600,height:400,style:{color:"#ddd",hoverColor:"rgba(255, 255, 255, 0.5)",borderColor:"white"},area:null},A=function(){function t(e){S(this,t),this.color=e.color||"cyan",this.level=e.level||5,this.data=e.data||[],this.thresholds=p(this.data,this.level),this.drawSubArea=g.bind(this),this.onEnter=b.bind(this),this.onLeave=w.bind(this)}return x(t,[{key:"beforeArea",value:function(){}},{key:"afterSubArea",value:function(t,e,n){this.drawSubArea(t,e,n)}},{key:"afterArea",value:function(){}}]),t}(),k=[{name:"广东",value:10430.03},{name:"山东",value:9579.31},{name:"河南",value:9402.36},{name:"四川",value:8041.82},{name:"江苏",value:7865.99},{name:"河北",value:7185.42},{name:"湖南",value:6568.37},{name:"安徽",value:5950.1},{name:"湖北",value:5723.77},{name:"浙江",value:5442},{name:"广西",value:4602.66},{name:"云南",value:4596.6},{name:"江西",value:4456.74},{name:"辽宁",value:4374.63},{name:"黑龙江",value:3831.22},{name:"陕西",value:3732.74},{name:"山西",value:3571.21},{name:"福建",value:3552},{name:"贵州",value:3476.65},{name:"重庆",value:2884},{name:"吉林",value:2746.22},{name:"甘肃",value:2557.53},{name:"内蒙古",value:2470.63},{name:"台湾",value:2316.2},{name:"上海",value:2301.391},{name:"新疆",value:2181.33},{name:"北京",value:1961.2},{name:"天津",value:1293.82},{name:"海南",value:867.15},{name:"香港",value:709.76},{name:"宁夏",value:630.14},{name:"青海",value:562.67},{name:"西藏",value:300.21},{name:"澳门",value:55.23}],M=new A({data:k});return function(){function t(e){S(this,t),this.init(e),this.update()}return x(t,[{key:"init",value:function(t){var e=this;t.style=Object.assign({},Y.style,t.style),t=Object.assign({},Y,t),Object.keys(t).forEach(function(n){e[n]=t[n]}),this.layer=M,v.bind(this)()}},{key:"update",value:function(){m.bind(this)()}}]),t}()}();
