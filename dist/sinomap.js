var Sinomap=function(){"use strict";function t(t,n){var e=m*t*y,i=Math.max(Math.min(v,n),-v)*y;return i=m*Math.log(Math.tan(Math.PI/4+i/2)),[e,i]}function n(n){var e=[];return n.features.forEach(function(n){"Polygon"===n.geometry.type?n.geometry.coordinates.forEach(function(n){e=e.concat(n.map(function(n){return t(n[0],n[1])}))}):n.geometry.coordinates.forEach(function(n){n.forEach(function(n){e=e.concat(n.map(function(n){return t(n[0],n[1])}))})})}),e}function e(t){var n=t.reduce(function(t,n){return t[0]<n[0]?t:n})[0],e=t.reduce(function(t,n){return t[0]>n[0]?t:n})[0],i=t.reduce(function(t,n){return t[1]<n[1]?t:n})[1];return{w:e-n,h:t.reduce(function(t,n){return t[1]>n[1]?t:n})[1]-i,minX:n,minY:i}}function i(t,n){var e=d(t,2),i=e[0],r=e[1],o=d(n,2),a=o[0],c=o[1],u=i/r/(a/c)>1,h=u?a/i:c/r;return[u?0:(a-i*h)/2,u?(c-r*h)/2:0,h]}function r(n,e,i){return i.map(function(i){var r=t(i[0],i[1]),o=d(r,2),a=o[0],c=o[1];return[a-n,c-e]})}function o(t,r,o){var a=n(t),c=e(a),u=i([c.w,c.h],[r,o]),h=d(u,3),s=h[0],f=h[1],l=h[2];return{offsetX:s,offsetY:f,minX:c.minX,minY:c.minY,areaScale:l}}function a(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1}function c(t,n,e){var i=document.createElement("canvas");return i.width=t*e,i.height=n*e,i.style.width=t+"px",i.style.height=n+"px",i.getContext("2d").scale(e,e),i}function u(t){var n=this;t.addEventListener("mousemove",function(t){var e=n.mapCanvas.getBoundingClientRect(),i=t.clientX,r=t.clientY;n.mouseX=(i-e.left)*n.mapCanvas.width/e.width,n.mouseY=(r-e.top)*n.mapCanvas.height/e.height,n.update()})}function h(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=n.offsetX,i=n.offsetY,o=n.minX,a=n.minY,c=n.areaScale,u=r(o,a,t);this.ctx.fillStyle=this.style.color,this.ctx.strokeStyle=this.style.borderColor;for(var h=0;h<u.length;h++){var s=[u[h][0],u[h][1]],f=s[0],l=s[1];0===h&&this.ctx.beginPath(),this.ctx.lineTo(f*c+e,this.height-l*c-i)}this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}function s(t,n,e){var i="string"==typeof this.el?document.querySelector(this.el):this.el;if(!i)throw new Error("[Sinomap] Target element not found.");this.mouseX=0,this.mouseY=0,this.canvasScale=a(),this.mapCanvas=c(this.width,this.height,this.canvasScale),this.ctx=this.mapCanvas.getContext("2d"),i.appendChild(this.mapCanvas),u.bind(this)(this.mapCanvas)}function f(){var t=this,n=o(this.area,this.width,this.height);return this.area.features.forEach(function(e){"Polygon"===e.geometry.type?e.geometry.coordinates.forEach(function(e){return h.bind(t)(e,n)}):e.geometry.coordinates.forEach(function(e){return e.forEach(function(e){return h.bind(t)(e,n)})})}),this}function l(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var d=function(){function t(t,n){var e=[],i=!0,r=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(i=(a=c.next()).done)&&(e.push(a.value),!n||e.length!==n);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&c.return&&c.return()}finally{if(r)throw o}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=6378137,v=85.0511287798,y=Math.PI/180,g={el:null,width:600,height:400,style:{color:"#ddd",borderColor:"white"},area:null},p=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}();return function(){function t(n){return l(this,t),this.init(n),this.update(),this}return p(t,[{key:"init",value:function(t){var n=this;t.style=Object.assign({},g.style,t.style),t=Object.assign({},g,t),Object.keys(t).forEach(function(e){n[e]=t[e]}),s.bind(this)()}},{key:"update",value:function(){f.bind(this)()}}]),t}()}();
