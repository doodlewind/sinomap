var Sinomap=function(){"use strict";function e(e,t){var n=C*e*X,a=Math.max(Math.min(P,t),-P)*X;return a=C*Math.log(Math.tan(Math.PI/4+a/2)),[n,a]}function t(t){var n=[];return t.features.forEach(function(t){"Polygon"===t.geometry.type?t.geometry.coordinates.forEach(function(t){n=n.concat(t.map(function(t){return e(t[0],t[1])}))}):t.geometry.coordinates.forEach(function(t){t.forEach(function(t){n=n.concat(t.map(function(t){return e(t[0],t[1])}))})})}),n}function n(e){var t=e.reduce(function(e,t){return e[0]<t[0]?e:t})[0],n=e.reduce(function(e,t){return e[0]>t[0]?e:t})[0],a=e.reduce(function(e,t){return e[1]<t[1]?e:t})[1];return{w:n-t,h:e.reduce(function(e,t){return e[1]>t[1]?e:t})[1]-a,minX:t,minY:a}}function a(e,t){var n=E(e,2),a=n[0],r=n[1],i=E(t,2),o=i[0],u=i[1],l=a/r/(o/u)>1,c=l?o/a:u/r;return[l?0:(o-a*c)/2,l?(u-r*c)/2:0,c]}function r(t,n,a){return a.map(function(a){var r=e(a[0],a[1]),i=E(r,2),o=i[0],u=i[1];return[o-t,u-n]})}function i(e,r,i){var o=t(e),u=n(o),l=a([u.w,u.h],[r,i]),c=E(l,3),s=c[0],h=c[1],f=c[2];return{offsetX:s,offsetY:h,minX:u.minX,minY:u.minY,areaScale:f}}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.minX,a=t.minY,i=t.offsetX,o=t.offsetY,u=t.areaScale,l=t.height;return r(n,a,e).map(function(e){return[e[0]*u+i,l-e[1]*u-o]})}function u(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1}function l(e,t,n){var a=document.createElement("canvas");return a.width=e*n,a.height=t*n,a.style.width=e+"px",a.style.height=t+"px",a.getContext("2d").scale(n,n),a}function c(e){var t=this;e.addEventListener("mousemove",function(e){var n=t.mapCanvas.getBoundingClientRect();t.mouseX=(e.clientX-n.left)*t.mapCanvas.width/n.width,t.mouseY=(e.clientY-n.top)*t.mapCanvas.height/n.height,t.update()})}function s(e,t,n){e.fillStyle=n,f(e,t)}function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.offsetX,r=n.offsetY,i=n.minX,u=n.minY,l=n.areaScale,c=o(e,{minX:i,minY:u,offsetX:a,offsetY:r,areaScale:l,height:this.height});this.ctx.fillStyle=this.style.color,this.ctx.strokeStyle=this.style.borderColor,f(this.ctx,c),this.ctx.stroke(),this.ctx.isPointInPath(this.mouseX,this.mouseY)&&s(this.ctx,c,this.style.hoverColor),this.layer.afterSubArea&&this.layer.afterSubArea(this,c,t)}function f(e,t){t.forEach(function(n,a){var r=[t[a][0],t[a][1]],i=r[0],o=r[1];0===a&&e.beginPath(),e.lineTo(i,o)}),e.closePath(),e.fill()}function v(e,t,n){var a="string"==typeof this.el?document.querySelector(this.el):this.el;if(!a)throw new Error("[Sinomap] Target element not found.");this.mouseX=0,this.mouseY=0,this.canvasScale=u(),this.mapCanvas=l(this.width,this.height,this.canvasScale),this.ctx=this.mapCanvas.getContext("2d"),this.utils={drawPath:f},a.appendChild(this.mapCanvas),c.bind(this)(this.mapCanvas)}function m(){var e=this,t=i(this.area,this.width,this.height);this.area.features.forEach(function(n){"Polygon"===n.geometry.type?n.geometry.coordinates.forEach(function(a){return h.bind(e)(a,n.properties,t)}):n.geometry.coordinates.forEach(function(a){return a.forEach(function(a){return h.bind(e)(a,n.properties,t)})})})}function d(e,t){var n=null;return t.forEach(function(t){t.name===e&&(n=t.value)}),n}function y(e,t){for(var n=e.length,a=e.map(function(e,t){return 1/n*(n-t)}),r=0;r<e.length;r++)if(t<=e[r])return"rgba(255, 255, 255, "+(a[r]-.1)+")"}function p(e,t){var n=e.map(function(e){return e.value});n.sort(function(e,t){return e>t?1:-1});var a=Math.floor(n.length/t);return a<=1?n:Array.from(new Array(t-1)).map(function(e,t){return n[a*(t+1)]})}function g(e,t,n){var a=parseInt(d(n.name,this.data));a&&(e.ctx.fillStyle=this.color,e.utils.drawPath(e.ctx,t),e.ctx.fillStyle=y(this.thresholds,a),e.utils.drawPath(e.ctx,t))}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){}function S(e){}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var E=function(){function e(e,t){var n=[],a=!0,r=!1,i=void 0;try{for(var o,u=e[Symbol.iterator]();!(a=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),C=6378137,P=85.0511287798,X=Math.PI/180,Y={el:null,width:600,height:400,style:{color:"#ddd",hoverColor:"rgba(255, 255, 255, 0.5)",borderColor:"white"},area:null},A=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),k=function(){function e(t){b(this,e),this.color=t.color||"cyan",this.level=t.level||5,this.data=t.data||[],this.thresholds=p(this.data,this.level),this.drawSubArea=g.bind(this),this.onEnter=w.bind(this),this.onLeave=S.bind(this)}return A(e,[{key:"beforeArea",value:function(){}},{key:"afterSubArea",value:function(e,t,n){this.drawSubArea(e,t,n)}},{key:"afterArea",value:function(){}}]),e}(),M=[{name:"广东",value:10430.03},{name:"山东",value:9579.31},{name:"河南",value:9402.36},{name:"四川",value:8041.82},{name:"江苏",value:7865.99},{name:"河北",value:7185.42},{name:"湖南",value:6568.37},{name:"安徽",value:5950.1},{name:"湖北",value:5723.77},{name:"浙江",value:5442},{name:"广西",value:4602.66},{name:"云南",value:4596.6},{name:"江西",value:4456.74},{name:"辽宁",value:4374.63},{name:"黑龙江",value:3831.22},{name:"陕西",value:3732.74},{name:"山西",value:3571.21},{name:"福建",value:3552},{name:"贵州",value:3476.65},{name:"重庆",value:2884},{name:"吉林",value:2746.22},{name:"甘肃",value:2557.53},{name:"内蒙古",value:2470.63},{name:"台湾",value:2316.2},{name:"上海",value:2301.391},{name:"新疆",value:2181.33},{name:"北京",value:1961.2},{name:"天津",value:1293.82},{name:"海南",value:867.15},{name:"香港",value:709.76},{name:"宁夏",value:630.14},{name:"青海",value:562.67},{name:"西藏",value:300.21},{name:"澳门",value:55.23}],j=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),O=new k({data:M});return function(){function e(t){x(this,e),this.init(t),this.update()}return j(e,[{key:"init",value:function(e){var t=this;e.style=Object.assign({},Y.style,e.style),e=Object.assign({},Y,e),Object.keys(e).forEach(function(n){t[n]=e[n]}),this.layer=O,v.bind(this)()}},{key:"update",value:function(){m.bind(this)()}}]),e}()}();
