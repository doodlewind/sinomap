var Sinomap=function(){"use strict";function t(t,n){var e=g*t*b,i=Math.max(Math.min(w,n),-w)*b;return i=g*Math.log(Math.tan(Math.PI/4+i/2)),[e,i]}function n(n){var e=[];return n.features.forEach(function(n){"Polygon"===n.geometry.type?n.geometry.coordinates.forEach(function(n){e=e.concat(n.map(function(n){return t(n[0],n[1])}))}):n.geometry.coordinates.forEach(function(n){n.forEach(function(n){e=e.concat(n.map(function(n){return t(n[0],n[1])}))})})}),e}function e(t){var n=t.reduce(function(t,n){return t[0]<n[0]?t:n})[0],e=t.reduce(function(t,n){return t[0]>n[0]?t:n})[0],i=t.reduce(function(t,n){return t[1]<n[1]?t:n})[1];return{w:e-n,h:t.reduce(function(t,n){return t[1]>n[1]?t:n})[1]-i,minX:n,minY:i}}function i(t,n){var e=p(t,2),i=e[0],r=e[1],o=p(n,2),a=o[0],u=o[1],c=i/r/(a/u)>1,h=c?a/i:u/r;return[c?0:(a-i*h)/2,c?(u-r*h)/2:0,h]}function r(n,e,i){return i.map(function(i){var r=t(i[0],i[1]),o=p(r,2),a=o[0],u=o[1];return[a-n,u-e]})}function o(t,r,o){var a=n(t),u=e(a),c=i([u.w,u.h],[r,o]),h=p(c,3),s=h[0],f=h[1],l=h[2];return{offsetX:s,offsetY:f,minX:u.minX,minY:u.minY,areaScale:l}}function a(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=n.minX,i=n.minY,o=n.offsetX,a=n.offsetY,u=n.areaScale,c=n.height;return r(e,i,t).map(function(t){return[t[0]*u+o,c-t[1]*u-a]})}function u(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1}function c(t,n,e){var i=document.createElement("canvas");return i.width=t*e,i.height=n*e,i.style.width=t+"px",i.style.height=n+"px",i.getContext("2d").scale(e,e),i}function h(t){var n=this;t.addEventListener("mousemove",function(t){var e=n.mapCanvas.getBoundingClientRect();n.mouseX=(t.clientX-e.left)*n.mapCanvas.width/e.width,n.mouseY=(t.clientY-e.top)*n.mapCanvas.height/e.height,n.update()})}function s(t,n,e){t.fillStyle=e,l(t,n)}function f(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=e.offsetX,r=e.offsetY,o=e.minX,u=e.minY,c=e.areaScale,h=a(t,{minX:o,minY:u,offsetX:i,offsetY:r,areaScale:c,height:this.height});this.ctx.fillStyle=this.color,this.ctx.strokeStyle=this.borderColor,l(this.ctx,h),this.ctx.stroke(),this.ctx.isPointInPath(this.mouseX,this.mouseY)&&s(this.ctx,h,this.hoverColor),this.layer.afterSubArea&&this.layer.afterSubArea(this,h,n)}function l(t,n){n.forEach(function(e,i){var r=[n[i][0],n[i][1]],o=r[0],a=r[1];0===i&&t.beginPath(),t.lineTo(o,a)}),t.closePath(),t.fill()}function d(t,n,e){var i="string"==typeof this.el?document.querySelector(this.el):this.el;if(!i)throw new Error("[Sinomap] Target element not found.");this.mouseX=0,this.mouseY=0,this.canvasScale=u(),this.mapCanvas=c(this.width,this.height,this.canvasScale),this.ctx=this.mapCanvas.getContext("2d"),this.utils={drawPath:l},i.appendChild(this.mapCanvas),h.bind(this)(this.mapCanvas)}function m(){var t=this,n=o(this.area,this.width,this.height);this.area.features.forEach(function(e){"Polygon"===e.geometry.type?e.geometry.coordinates.forEach(function(i){return f.bind(t)(i,e.properties,n)}):e.geometry.coordinates.forEach(function(i){return i.forEach(function(i){return f.bind(t)(i,e.properties,n)})})})}var v=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},y=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),p=function(){function t(t,n){var e=[],i=!0,r=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done)&&(e.push(a.value),!n||e.length!==n);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&u.return&&u.return()}finally{if(r)throw o}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=6378137,w=85.0511287798,b=Math.PI/180,x={el:null,width:600,height:400,layer:{},color:"#ddd",hoverColor:"rgba(255, 255, 255, 0.5)",borderColor:"white",area:null};return function(){function t(n){v(this,t),this.init(n),this.update()}return y(t,[{key:"init",value:function(t){var n=this;t=Object.assign({},x,t),Object.keys(t).forEach(function(e){n[e]=t[e]}),d.bind(this)()}},{key:"update",value:function(){m.bind(this)()}}]),t}()}();
