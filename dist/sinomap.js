var Sinomap=function(){"use strict";function t(t,n){var e=v*t*y,i=Math.max(Math.min(g,n),-g)*y;return i=v*Math.log(Math.tan(Math.PI/4+i/2)),[e,i]}function n(n){var e=[];return n.features.forEach(function(n){"Polygon"===n.geometry.type?n.geometry.coordinates.forEach(function(n){e=e.concat(n.map(function(n){return t(n[0],n[1])}))}):n.geometry.coordinates.forEach(function(n){n.forEach(function(n){e=e.concat(n.map(function(n){return t(n[0],n[1])}))})})}),e}function e(t){var n=t.reduce(function(t,n){return t[0]<n[0]?t:n})[0],e=t.reduce(function(t,n){return t[0]>n[0]?t:n})[0],i=t.reduce(function(t,n){return t[1]<n[1]?t:n})[1];return{w:e-n,h:t.reduce(function(t,n){return t[1]>n[1]?t:n})[1]-i,xMin:n,yMin:i}}function i(t,n){var e=l(t,2),i=e[0],r=e[1],o=l(n,2),a=o[0],c=o[1],h=i/r/(a/c)>1,u=h?a/i:c/r;return[h?0:(a-i*u)/2,h?(c-r*u)/2:0,u]}function r(t,r,o){var a=n(t),c=e(a),h=i([c.w,c.h],[r,o]),u=l(h,3),f=u[0],d=u[1],s=u[2];return{offsetX:f,offsetY:d,xMin:c.xMin,yMin:c.yMin,scale:s}}function o(n,e,i){return i.map(function(i){var r=t(i[0],i[1]),o=l(r,2),a=o[0],c=o[1];return[a-n,c-e]})}function a(){return"devicePixelRatio"in window&&window.devicePixelRatio>1?window.devicePixelRatio:1}function c(t,n){var e=document.createElement("canvas"),i=a();return e.width=t*i,e.height=n*i,e.style.width=t+"px",e.style.height=n+"px",e.getContext("2d").scale(i,i),e}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.el,e=void 0===n?"#map":n,i=t.width,r=void 0===i?1e3:i,o=t.height,a=void 0===o?600:o,h=document.querySelector(e),u=c(r,a);return h.appendChild(u),u}function u(){return"#"+[parseInt(1e4*Math.random())%256,parseInt(1e4*Math.random())%256,parseInt(1e4*Math.random())%256].map(function(t){return t.toString(16)}).join("")}function f(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(e.width,e.height),r=void 0===i?0:i,a=e.xOff,c=void 0===a?0:a,h=e.yOff,u=void 0===h?0:h,f=e.xMin,d=void 0===f?0:f,s=e.yMin,l=void 0===s?0:s,v=e.scale,g=void 0===v?2e4:v,y=e.color,w=void 0===y?"#ddd":y,m=o(d,l,n);t.fillStyle=w;for(var p=0;p<m.length;p++){var M=[m[p][0],m[p][1]],x=M[0],E=M[1];0===p&&t.beginPath(),t.lineTo(x*g+c,r-E*g-u)}t.closePath(),t.fill()}function d(){var t=h({width:this.width,height:this.height}),n=t.getContext("2d"),e=r(this.geoJSON,this.width,this.height),i={width:this.width,height:this.height,xOff:e.offsetX,yOff:e.offsetY,xMin:e.xMin,yMin:e.yMin,scale:e.scale};return this.geoJSON.features.forEach(function(t){i.color=u(),"Polygon"===t.geometry.type?t.geometry.coordinates.forEach(function(t){f(n,t,i)}):t.geometry.coordinates.forEach(function(t){t.forEach(function(t){f(n,t,i)})})}),this}function s(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var l=function(){function t(t,n){var e=[],i=!0,r=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(i=(a=c.next()).done)&&(e.push(a.value),!n||e.length!==n);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&c.return&&c.return()}finally{if(r)throw o}}return e}return function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return t(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=6378137,g=85.0511287798,y=Math.PI/180,w=function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=n.width,i=void 0===e?1e3:e,r=n.height,o=void 0===r?600:r,a=n.geoJSON,c=void 0===a?null:a;s(this,t),this.width=i,this.height=o,this.geoJSON=c,this.renderMap=d,this.renderMap()};return"undefined"!=typeof module&&(window.Sinomap=w),w}();
